<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>EPUB Pandoc Architect</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <link rel="stylesheet" href="style.css" />
    <style id="live-css"></style>
  </head>
  <body>
    <div id="path-modal">
      <div class="modal-content">
        <h3>Pandoc Not Found</h3>
        <p>
          The system cannot find Pandoc. Paste the absolute path to
          <strong>pandoc.exe</strong>:
        </p>
        <input
          type="text"
          id="manual-pandoc-path"
          placeholder="C:\Program Files\Pandoc\pandoc.exe"
        />
        <div class="modal-actions">
          <button
            onclick="
              document.getElementById('path-modal').style.display = 'none'
            "
            class="btn-secondary"
          >
            Cancel
          </button>
          <button onclick="savePandocPath()" class="btn-success">
            Save Path & Retry
          </button>
        </div>
      </div>
    </div>

    <header>
      <button onclick="pickProject()">üìÅ Open Project</button>
      <span id="project-name">No Project Loaded</span>
      <div class="header-divider">|</div>
      <label>
        Main Class:
        <input
          type="text"
          id="class-input"
          value="book-content"
          oninput="updatePreview()"
        />
      </label>
      <button onclick="compile()" id="compile-btn" class="btn-compile">
        üöÄ Compile EPUB
      </button>
      <button onclick="exitApp()" class="btn-danger" style="background: #d9534f; margin-left: auto;">‚ùå Exit App</button>
    </header> 
    </header>

    <main>
      <div id="editor-pane">
        <div class="editor-tabs">
          <button id="tab-btn-visual" class="tab-btn active" onclick="switchTab('visual')">üé® Visual Builder</button>
          <button id="tab-btn-raw" class="tab-btn" onclick="switchTab('raw')">üíª Raw CSS</button>
          
          <div style="flex-grow: 1;"></div>
          <button onclick="undoCSS()" class="icon-btn" title="Undo">‚Ü©Ô∏è</button>
          <button onclick="redoCSS()" class="icon-btn" title="Redo">‚Ü™Ô∏è</button>
          <button onclick="saveCSS()" id="save-css-btn" class="btn-success" style="margin-left: 8px; padding: 6px 12px; font-size: 13px;">üíæ Save CSS</button>
        </div>

        <div id="visual-tab" class="tab-content active">
          <div class="visual-controls">
            <label class="full-width">
              <strong>Target Markdown Element:</strong>
              <select id="ve-selector" onchange="loadVisualEditorState()">
                <option value=".book-content">Main Document (Body)</option>
                <option value=".book-content h1">Heading 1</option>
                <option value=".book-content h2">Heading 2</option>
                <option value=".book-content h3">Heading 3</option>
                <option value=".book-content p">Paragraph</option>
                <option value=".book-content strong">Bold Text</option>
                <option value=".book-content em">Italic Text</option>
                <option value=".book-content ul">Bullet List</option>
                <option value=".book-content blockquote">Blockquote</option>
                <option value=".book-content pre code">Code Block</option>
              </select>
            </label>

            <label>
              Font Family:
              <select id="ve-font-family" onchange="applyVisualEditorState()">
                <option value="">(Default Theme Font)</option>
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Times New Roman', serif">
                  Times New Roman
                </option>
                <option value="Georgia, serif">Georgia</option>
                <option value="'Courier New', monospace">Courier New</option>
              </select>
            </label>

            <label>
              Font Size:
              <input
                type="text"
                id="ve-font-size"
                placeholder="e.g. 1.2em or 16px"
                oninput="applyVisualEditorState()"
              />
            </label>

            <label>
              Text Color:
              <div class="color-row">
                <input
                  type="color"
                  id="ve-color-picker"
                  oninput="
                    document.getElementById('ve-color').value = this.value;
                    applyVisualEditorState();
                  "
                />
                <input
                  type="text"
                  id="ve-color"
                  placeholder="#000000"
                  oninput="applyVisualEditorState()"
                />
              </div>
            </label>

            <label>
              Background Color:
              <div class="color-row">
                <input
                  type="color"
                  id="ve-bg-picker"
                  oninput="
                    document.getElementById('ve-bg').value = this.value;
                    applyVisualEditorState();
                  "
                />
                <input
                  type="text"
                  id="ve-bg"
                  placeholder="transparent"
                  oninput="applyVisualEditorState()"
                />
              </div>
            </label>

            <label>
              Text Align:
              <select id="ve-text-align" onchange="applyVisualEditorState()">
                <option value="">(Default)</option>
                <option value="left">Left</option>
                <option value="center">Center</option>
                <option value="right">Right</option>
                <option value="justify">Justify</option>
              </select>
            </label>

            <div style="margin-top: 12px; padding-top: 16px; border-top: 1px solid var(--border);">
              <strong style="display: block; margin-bottom: 12px; color: var(--text-muted);">Quick Center Elements</strong>
              
              <label style="flex-direction: row; align-items: center; gap: 8px;">
                <input type="checkbox" id="center-headings" style="width: auto; flex-grow: 0;">
                <span>Headings (h1-h3)</span>
              </label>
              
              <label style="flex-direction: row; align-items: center; gap: 8px;">
                <input type="checkbox" id="center-paragraphs" style="width: auto; flex-grow: 0;">
                <span>Paragraphs</span>
              </label>
              
              <label style="flex-direction: row; align-items: center; gap: 8px;">
                <input type="checkbox" id="center-images" style="width: auto; flex-grow: 0;">
                <span>Images</span>
              </label>
              
              <label style="flex-direction: row; align-items: center; gap: 8px;">
                <input type="checkbox" id="center-blockquotes" style="width: auto; flex-grow: 0;">
                <span>Blockquotes</span>
              </label>
              
              <button onclick="applyQuickCenter()" style="margin-top: 12px; width: 100%;">
                Apply Centering
              </button>
            </div>
          </div>
        </div>

        <div id="raw-tab" class="tab-content" style="display: none">
          <textarea
            id="css-editor"
            oninput="handleRawCSSTyping()" 
            placeholder="/* Write scoped CSS here... */"
          ></textarea>
        </div>

        <div id="chapter-selector-container">
          <label for="chapter-select">Preview Chapter:</label>
          <select id="chapter-select" onchange="changeChapter()"></select>
        </div>
      </div>

      <div id="preview-pane">
        <div id="epub-render-surface"></div>
      </div>
    </main>

    <script src="app.js"></script>
  </body>
</html>
